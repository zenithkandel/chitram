<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopping Cart - चित्रम्</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <div class="nav-brand">
                <a href="/">
                    <h1>चित्रम्</h1>
                    <span>Art Gallery</span>
                </a>
            </div>
            <ul class="nav-links">
                <li><a href="/">Home</a></li>
                <li><a href="/about">About</a></li>
                <li><a href="/artists">Artists</a></li>
                <li><a href="/gallery">Gallery</a></li>
                <li><a href="/apply">Apply</a></li>
                <li><a href="/track-orders">Track Orders</a></li>
                <li><a href="/cart" class="active">
                    <i class="fas fa-shopping-cart"></i> Cart
                    <span id="cart-count" class="cart-count" style="display: none;">0</span>
                </a></li>
            </ul>
        </div>
    </nav>

    <!-- Cart Content Section -->
    <section class="cart-section">
        <div class="container">
            <h1>Shopping Cart</h1>
            
            <div class="cart-container">
                <!-- Left Side - Cart Items -->
                <div class="cart-items-section">
                    <div id="cart-items-list">
                        <!-- Cart items will be populated here by JavaScript -->
                        <div id="empty-cart-message" class="empty-cart">
                            <i class="fas fa-shopping-cart"></i>
                            <h3>Your cart is empty</h3>
                            <p>Browse our gallery and add some beautiful artworks to your cart!</p>
                            <a href="/gallery" class="btn-primary">Continue Shopping</a>
                        </div>
                    </div>
                </div>

                <!-- Right Side - Order Summary -->
                <div class="order-summary-section">
                    <div class="order-summary">
                        <h3>Order Summary</h3>
                        
                        <div class="summary-details">
                            <div class="summary-row">
                                <span>Items (<span id="total-items">0</span>)</span>
                                <span id="subtotal-amount">₹0</span>
                            </div>
                            
                            <div class="summary-row">
                                <span>Platform Commission</span>
                                <span>₹25</span>
                            </div>
                            
                            <hr class="summary-divider">
                            
                            <div class="summary-row total-row">
                                <span>Total Amount</span>
                                <span id="total-amount">₹25</span>
                            </div>
                        </div>
                        
                        <button id="checkout-btn" class="checkout-btn" disabled>
                            <i class="fas fa-credit-card"></i>
                            Proceed to Checkout
                        </button>
                        
                        <div class="security-note">
                            <i class="fas fa-shield-alt"></i>
                            <span>Secure checkout process</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2024 चित्रम् Art Gallery. All rights reserved.</p>
        </div>
    </footer>

    <!-- JavaScript -->
    <script src="/js/cart.js"></script>
    <script src="/js/main.js"></script>
    <script>
        // Cart page specific functionality
        class CartPage {
            constructor() {
                this.platformCommission = 25;
                this.init();
            }

            init() {
                this.loadCartItems();
                this.bindEvents();
            }

            bindEvents() {
                // Refresh cart when storage changes
                window.addEventListener('storage', () => {
                    this.loadCartItems();
                });
            }

            loadCartItems() {
                const cartItems = cartManager.getCartItems();
                this.displayCartItems(cartItems);
                this.updateOrderSummary(cartItems);
            }

            displayCartItems(items) {
                const cartItemsList = document.getElementById('cart-items-list');
                const emptyMessage = document.getElementById('empty-cart-message');

                if (items.length === 0) {
                    emptyMessage.style.display = 'block';
                    cartItemsList.innerHTML = '';
                    cartItemsList.appendChild(emptyMessage);
                    return;
                }

                emptyMessage.style.display = 'none';
                
                const itemsHTML = items.map(item => `
                    <div class="cart-item" data-item-id="${item.unique_id}">
                        <div class="item-image">
                            <img src="${item.art_image}" alt="${item.art_name}" 
                                 onerror="handleCartImageError(this)">
                        </div>
                        
                        <div class="item-details">
                            <h4 class="item-name">${item.art_name}</h4>
                            <p class="item-artist">by ${item.artist_name || 'Unknown Artist'}</p>
                            <p class="item-added">Added ${this.getRelativeTime(item.added_at)}</p>
                        </div>
                        
                        <div class="item-price">
                            <span class="price">₹${parseFloat(item.cost).toLocaleString('en-IN')}</span>
                        </div>
                        
                        <div class="item-actions">
                            <button class="remove-btn" onclick="cartPage.removeItem('${item.unique_id}')" 
                                    title="Remove from cart">
                                <i class="fas fa-trash"></i>
                            </button>
                            <a href="/artwork/${item.unique_id}" class="view-btn" title="View details">
                                <i class="fas fa-eye"></i>
                            </a>
                        </div>
                    </div>
                `).join('');

                cartItemsList.innerHTML = itemsHTML;
            }

            updateOrderSummary(items) {
                const totalItems = items.length;
                const subtotal = items.reduce((sum, item) => sum + parseFloat(item.cost), 0);
                const total = subtotal + this.platformCommission;

                document.getElementById('total-items').textContent = totalItems;
                document.getElementById('subtotal-amount').textContent = `₹${subtotal.toLocaleString('en-IN')}`;
                document.getElementById('total-amount').textContent = `₹${total.toLocaleString('en-IN')}`;

                // Enable/disable checkout button
                const checkoutBtn = document.getElementById('checkout-btn');
                if (totalItems > 0) {
                    checkoutBtn.disabled = false;
                    checkoutBtn.classList.remove('disabled');
                } else {
                    checkoutBtn.disabled = true;
                    checkoutBtn.classList.add('disabled');
                }
            }

            removeItem(itemId) {
                if (confirm('Are you sure you want to remove this item from your cart?')) {
                    cartManager.removeFromCart(itemId);
                    this.loadCartItems(); // Refresh the display
                }
            }

            getRelativeTime(dateString) {
                const now = new Date();
                const addedDate = new Date(dateString);
                const diffInSeconds = Math.floor((now - addedDate) / 1000);

                if (diffInSeconds < 60) return 'just now';
                if (diffInSeconds < 3600) return `${Math.floor(diffInSeconds / 60)} minutes ago`;
                if (diffInSeconds < 86400) return `${Math.floor(diffInSeconds / 3600)} hours ago`;
                return `${Math.floor(diffInSeconds / 86400)} days ago`;
            }
        }

        // Handle cart image errors
        function handleCartImageError(img) {
            if (img.src.includes('placeholder-art.jpg')) return;
            img.src = '/images/placeholder-art.jpg';
            img.onerror = function() {
                this.style.display = 'none';
                this.parentNode.innerHTML = '<div class="image-placeholder"><i class="fas fa-image"></i></div>';
            };
        }

        // Initialize cart page
        const cartPage = new CartPage();

        // Checkout button functionality (placeholder for now)
        document.getElementById('checkout-btn').addEventListener('click', function() {
            if (!this.disabled) {
                alert('Checkout functionality will be implemented next!');
            }
        });
    </script>
</body>
</html>
